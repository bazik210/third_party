////////////////////////////////////////////////////////////////////////////
//	Created		: 05.12.2010
//	Author		: Nikolay Partas
//	Copyright (C) GSC Game World - 2010
////////////////////////////////////////////////////////////////////////////

/*	$DEFINES$:
		GLOBAL_USE_BRANCHING,
		CONFIG_VERTEX_INPUT_TYPE,
*/

#include "common.h"
#include "material.h"
#include "vertex_input.h"
#include "psf_tc_modifiers.h"

float3 distortion_scale;
float3 move_direction;

float4 	main			(in vertex_output_struct input) : SV_TARGET0
{
	material_parameters parameters = get_material_parameters(input);
	fill_material_parameters(parameters);
	
	float2 uv_moved = psf_move_tc(parameters.tc, move_direction.xy * scene_time);
	float2 uv 		= parameters.tc;
	
	float3 dist_vector 	= t_base.Sample(s_linear, uv_moved).xyz;
	float  dist_alpha	= parameters.color.a * t_base.Sample(s_linear, uv).a;
	
	float4 distortion_and_alpha	= parameters.color * float4( t_base.Sample(s_linear, uv_moved).xyz, t_base.Sample(s_linear, uv).a);
	
	return float4((dist_vector.xy * 2.0f - 1.0f) * parameters.color.rg * distortion_scale.xy * dist_alpha / 255.0f, 1, 1.0);/*pack_distortion(
		(distortion_and_alpha.xy * 2.0f - 1.0f)// * distortion_scale.xy// * distortion_and_alpha.a
	);*/
}