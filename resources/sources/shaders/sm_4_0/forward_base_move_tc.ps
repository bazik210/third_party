////////////////////////////////////////////////////////////////////////////
//	Created		: 01.12.2010
//	Author		: Nikolay Partas
//	Copyright (C) GSC Game World - 2010
////////////////////////////////////////////////////////////////////////////

#define V2P_PARAM_H_POSITION 	1
#define V2P_PARAM_TC0		 	1
#define V2P_PARAM_TC1		 	1
#define V2P_PARAM_COLOR0	 	1

#include "common.h"
#include "v2p_common.h"
#include "v2p_base.h"

#include "psf_tc_modifiers.h"

float3 rotation_params;
float2 move_direction;

static const float2 rotation_center = rotation_params.xy;
static const float rotation_speed = rotation_params.z;

#include "material.h"
#include "vertex_input.h"

float4 far_fog_color_and_distance;
float near_fog_distance;

float4 	main			(in vertex_output_struct input) : SV_TARGET0
{
	material_parameters parameters = get_material_parameters(input);
	fill_material_parameters(parameters);
	
	float2 new_tc = psf_rotate_tc(parameters.tc, rotation_center, scene_time * rotation_speed);
		   new_tc = psf_move_tc(new_tc, scene_time * move_direction);
	
	float4 TexColor	= t_base.Sample( s_material1, new_tc );
	float4 output	= TexColor * parameters.color;
	
	float far_fog 		= 1.0f - saturate( exp( -(parameters.world_view_position.z - near_fog_distance) / (far_fog_color_and_distance.a) ) );
	output.rgb		= lerp(output.rgb, far_fog_color_and_distance.rgb, far_fog);
		
	return float4(output.rgb, output.a);
}
















