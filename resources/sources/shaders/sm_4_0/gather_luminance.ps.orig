////////////////////////////////////////////////////////////////////////////
//	Created		: 28.04.2011
//	Author		: Nikolay Partas
//	Copyright (C) GSC Game World - 2011
////////////////////////////////////////////////////////////////////////////

/*
	$DEFINES$:
		GLOBAL_USE_LOOP_UNROLLING,
*/

#include "common.h"
#include "gbuffer.h"
#include "dof_functions.h"
#include "gamma_correction.h"

Texture2D t_frame_color1;

float4 main( v2p_TL vin) : SV_TARGET
{
	float average_result_luminance	= 0.0f;
	float min_result_luminance 		= pow(2, 31);
	float max_result_luminance		= -pow(2, 31);
	
    UNROLL for(int y=-1; y<1; y++)
    UNROLL for(int x=-1; x<1; x++)
    {
		average_result_luminance 	+= t_frame_color1.Sample(s_position, vin.Tex0, int2(x,y)).r;
		min_result_luminance  		=  min(min_result_luminance, t_frame_color1.Sample(s_position, vin.Tex0, int2(x,y)).g);
		max_result_luminance  		=  max(max_result_luminance, t_frame_color1.Sample(s_position, vin.Tex0, int2(x,y)).b);
	}
    
	return							float4( average_result_luminance, min_result_luminance, max_result_luminance, 0 );
}