[SCE CONFIDENTIAL DOCUMENT]
PlayStation(R)3 Programmer Tool Toolchain 310.001
                    Copyright(C) 2009 Sony Computer Entertainment Inc.
                                                  All Rights Reserved.
======================================================================
以下にPlayStation(R)3 Programmer Tool Toolchain の変更点と不具合修正
を記述します。

- Release 310.001 の変更点
- Release 310.001 の不具合修正

======================================================================
Release 310.001 の変更点
----------------------------------------------------------------------
SN Systems社製リンカ
----------------------------------------------------------------------
[新規追加]
(B#73814)
- 圧縮されたPRX出力のサポートを追加しました。

(B#65903,B#68320)
- 出力ELFファイル中の多数のセクションのサポートを追加しました。

[仕様変更]
(B#77712)
- コマンドラインオプション --no-keep-memory を削除しました。

(B#76969)
- 破棄されたCOMDAT関数のための DWARF .debug_info エントリを抑制するように
  しました。

(B#76191)
- コマンドライン入力が、その種類を決定できない
  ためにスクリプトとして扱われたとき、警告を出力します。

(B#72624)
- 現在の仕様を反映させるため、FSELF の実装を修正しました。

(B#72190)
- 大きな出力ファイルに対するメモリ使用量を削減しました。

[不具合修正]
(B#79969)
- デッドストリッピングを行う際、GCC の -mno-toc モードとの互換性を
  向上しました。
  酷い場合は、この問題によって分岐命令を正しくリロケートするのに失敗する
  場合がありました。

(B#72768)
- 全ての警告・エラーメッセージに関して、それがコマンドラインスイッチに
  言及する際のダッシュの数を正確にしました。

(B#70351)
- global定義が存在していても、シンボルに対するweak定義が残る原因となる、
  デッドストリッピングの問題を修正しました。

(B#67211)
- グローバルとローカルの両方のシンボルから参照されるオブジェクトを重複除去
  するのにまれに失敗するのを修正しました。

----------------------------------------------------------------------
GCC
----------------------------------------------------------------------
[新規追加]
<PPU/SPU共通>
(B#74072)
- spu-lv2-objcopyとppu-lv2-objcopyに、'--binary-symbol-prefix <prefix>'
  オプションを追加しました。

(B#76503)
- コンパイラオプション -dp を -S または -save-temps と共に用いるとき、
  コンパイラはアセンブリ出力にクリティカルパス情報を含めます。

<PPU>
(B#75707)
- -mno-toc=<num> オプションを追加しました。
  <num> は'0', '1', '2'のいずれかでなければいけません。
  -mno-toc=2 は以前のリリースの -mno-toc (数値が続かない) と同様に
  振る舞います。
  -mno-toc=1 は -mno-toc=2 と似ていますが、関数ポインタ経由の呼び出し時の
  TOC 待避・復帰命令を残します。これは以前のリリースの -mno-toc の制限を
  回避するために使用します。
  -mno-toc=0 は nop と TOC 待避・復帰命令を常に発行します。
  デフォルトは -mno-toc=0 です。

[仕様変更]
<PPU/SPU共通>
(B#75017)
- C++の整数定数式の仕様が、浮動小数点型への変換を受け付けるように
  拡張されました。
  変換は更なる整数または列挙型への変換のオペランドでなければなりません。
  -Wno-constant-expression が指定されると、そのような変換に対する警告が
  抑制されます。
  -pedantic が指定されると、そのような変換はエラーとして扱われます。

<PPU>
(B#77237,B#77972)
- SDK3.0.0のSDKパッケージで行われた修正の一部を、toolchainで行うように
  変更しました。
  -mno-tocまたは-mno-toc=2オプションを指定すると、GCCは定義済みマクロの
  一つとしてCELL_GCM_SNC_NOTOCRESTORE_2マクロを定義するようになります。
  以下の不具合の再発を避けるため、SDK3.1.0のSDKパッケージと
  SDK3.0.0のtoolchainパッケージを組み合わて使用しないようにしてください。
  - GCCの-mno-tocオプションを有効にしてビルドした場合、libgcmにおいて
    不正な動作が発生する不具合
    (技術情報ID:200907-13  https://ps3.scedev.net/technotes/view/940)
  - PRXのデッドストリッピングが誤動作する不具合

<SPU>
(B#75162)
- リンカオプション'--stack-analysis'の出力を改良しました。
  '-Map map.txt' を指定してマップファイルを生成する際に、'--stack-analysis'
  はより詳細なコールグラフを表示します。

(B#76503)
- 不要な nop やレジスタのコピーを削減し、生成される
  SPUコードの性能とサイズを改善しました。

(B#74827)
- -mspurs-job を指定することによってリンクされるオブジェクトが
  job_start_gcc.o から job_start.o に変更になりました。

(B#73739)
- SPU GUIDを計算するアルゴリズムを変更し、衝突が起こりにくいようにしました。

[不具合修正]
<PPU/SPU共通>
(B#73429)
- 以下の不具合を修正しました。

  - 以下のinternal compiler errorが起こることがある:
      internal compiler error: in int_mode_for_mode, at stor-layout.c:249

(B#72731)
- 以下の不具合を修正しました。

  - C++ プリプロセッサがセグメンテーションフォルトを起こすことがある

(B#66343)
- 以下の不具合を修正しました。

  - 限定された名前探索の動作に問題があり、以下の例が期待通りの
    エラーにならない

      namespace Y {
        void f();
      }
      namespace A {
        using namespace Y;
      }
      namespace B {
        void f();
      }
      namespace AB {
        using namespace A;
        using namespace B;
      }
      int main()
      {
        AB::f(); // エラー:オーバーロードされた 'f()' の呼び出しは曖昧である
                 // 候補は void B::f(), void Y::f()
        return 0;
      }

(B#75704)
- 以下の不具合を修正しました。

  - 仮想メソッドを持つ複数のクラスを継承した派生クラスをDとするとき、
    Dへのconst参照をキャストして、Dの基底クラスのうちの一つへの
    非const参照にすると、不正なアドレスを指す参照になってしまう

(B#76934)
- 以下の不具合を修正しました。

  - 文脈依存キーワード vector は'vector vector::xxx()'と記述されると
    正しく認識されないことがある

(B#77076)
- 以下の不具合を修正しました。

  - 以下のinternal compiler errorが起こることがある
    internal compiler error: in import_export_decl, at cp/decl2.c:1727

(B#77629)
- 以下の不具合を修正しました。

  - SDK が /usr/local/cell 以外にインストールされていると、
    -frepo オプションが動作しない

(B#76337)
- 以下の不具合を修正しました。

  - いくつかのエラーメッセージでは、前に"error:"という文字列がついて
    表示されない

(B#77574)
- 以下の不具合を修正しました。

  - Windows のレスポンスファイル中のダブルクォーテーションに対して
    エスケープ文字(\)が作用しない

<PPU>
(B#72249)
- 以下の不具合を修正しました。

  - ppu-lv2-ar は 'ru' コマンドを指定すると失敗します

(B#75167)
- 以下の不具合を修正しました。

  - 以下のコードが最適化されると、x.f と y.f が同じレジスタに割り当てられる

    struct S {
      float f;
      int i;
    } __attribute__((d64_abi));

    struct S g(struct S x, struct S y)
    {
      struct S z;
      z.f = x.f + y.f;
      z.i = x.i + y.i;
      return z;
    }

(B#74690)
- 以下の不具合を修正しました。

  - PPU VMX組み込み関数vec_lvlxの不具合
    (技術情報ID:200908-02  https://ps3.scedev.net/technotes/view/944)

(B#77070)
- 以下の不具合を修正しました。

  - -mno-toc を使用し、ループを含むコードを最適化すると
    コンパイラがクラッシュする

(B#71022)
- ベクタ型に対する演算の最適化で、次のようなinternal compiler errorが
  発生する場合があるという不具合を修正しました。
  internal compiler error: in rs6000_split_lve, at config/rs6000/rs6000.c:2931

<SPU>
(B#74996)
- 以下の不具合を修正しました。

  - --stack-analysisオプションを使用するとSPUリンカがクラッシュする
